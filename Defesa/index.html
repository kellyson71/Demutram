<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Defesa Prévia DEMUTRAN</title>
    <link rel="stylesheet" href="./style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<style>
    select {
        position: relative;
        padding-right: 30px;
        background: url('data:image/svg+xml;charset=US-ASCII,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><polygon fill="%23009640" points="5,7 10,12 15,7"/></svg>') no-repeat right center;
        background-size: 15px;
    }

    select:focus {
        border-bottom: 1px solid #00C851;
    }

    select:focus ~ .underline {
        transform: scaleX(1);
    }

    .input-field {
        position: relative;
    }

    .input-field select {
        background-position: calc(100% - 10px) center;
    }

    select:focus ~ label,
    select:valid ~ label {
        top: -20px;
        left: 0;
        font-size: 12px;
        color: #00C851;
    }

    .input-field select ~ .underline {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 2px;
        background-color: #00C851;
        transform: scaleX(0);
        transition: transform 0.3s ease-in-out;
    }
</style>

<body>
    <div class="feedback" id="feedback"></div>
    <header>
        <nav>
            <ul>
                <li><a href="https://www.instagram.com/prefeituradepaudosferros/"><img src="../assets/instagram.png" alt="Instagram"></a></li>
                <li><a href="https://www.facebook.com/prefeituradepaudosferros/"><img src="../assets/facebook.png" alt="Facebook"></a></li>
                <li><a href="https://twitter.com/paudosferros"><img src="../assets/twitter.png" alt="Twitter"></a></li>
                <li><a href="https://www.youtube.com/c/prefeituramunicipaldepaudosferros"><img src="../assets/youtube.png" alt="YouTube"></a></li>
                <li><a href="https://wa.me/558499440704"><img src="../assets/copy-url.png" alt="URL"></a></li>
            </ul>
        </nav>
        <div class="user-options">
            <!-- <p id="alter-font">Tamanho da fonte</p>
            <button onclick="increaseFont()">A+</button>
            <p>|</p>
            <button onclick="decreaseFont()">A-</button> -->
        </div>
    </header>
    <div class="topbar-secondary">
        <div class="container_bar">
            <a href="../index.html">Início</a> > <a href="https://paudosferros.rn.gov.br/secretaria.php?sec=19">Demutran – DEPARTAMENTO MUNICIPAL DE TRÂNSITO</a>
            <span class="separator"> | </span>
            <a href="https://paudosferros.rn.gov.br/lai.php">Acesso à Informação</a> - <a href="https://paudosferros.rn.gov.br/omunicipio.php">Sobre a Prefeitura</a>
        </div>
    </div>
  <div class="form-container">
        <h2><i class="far fa-edit"></i><span> Solicitação DEMUTRAN</span></h2>
        <p style="padding-bottom: 40px;"><strong>Preencha todos os dados para podermos dar continuidade a sua solicitação.</strong></p>
        <form id="DefesaForm" method="post" enctype="multipart/form-data">
            <div class="input-field">
                <select id="tipo_solicitacao" name="tipo_solicitacao" >
                    <option value="" disabled selected></option>
                    <option value="defesa_previa">Defesa Prévia</option>
                    <option value="apresentacao_condutor">Apresentação do Condutor</option>
                    <option value="jari">JARI</option>
                </select>
                <label for="tipo_solicitacao" style="top: -20px;"><i class="fas fa-list"></i> TIPO DA SOLICITAÇÃO</label>
                <div class="underline"></div>
            </div>
            <div id="form_normal">
                <div class="input-field">
                    <input type="text" id="nome" name="nome" >
                    <label for="nome"><i class="fas fa-user"></i> Seu nome:</label>
                    <div class="underline"></div>
                </div>
                <div class="input-field">
                    <input type="tel" id="telefone" name="telefone" >
                    <label for="telefone"><i class="fas fa-phone"></i> Telefone Para Contato:</label>
                    <div class="underline"></div>
                </div>
                <div class="input-field">
                    <input type="email" id="email" name="email" >
                    <label for="email"><i class="fas fa-envelope"></i> Seu e-mail:</label>
                    <div class="underline"></div>
                </div>
                <div class="input-field">
                    <input type="text" id="assunto" name="assunto" >
                    <label for="assunto"><i class="fas fa-comment"></i> Assunto:</label>
                    <div class="underline"></div>
                </div>
                <div>
                    <h1 style="font-size: 15px; margin-bottom: 30px; font-family: 'Roboto', sans-serif; color: #6C757D;">apenas em pdf*</h1>            
                </div>
                <div class="input-field">
                    <input type="file" id="doc_requerimento" name="doc_requerimento" accept=".pdf">
                    <label for="doc_requerimento"><i class="far fa-file-alt"></i> Anexar formulário preenchido e assinado:</label>
                    <div class="underline"></div>
                </div>
                <div class="input-field">
                    <input type="file" id="cnh" name="cnh" accept=".pdf">
                    <label for="cnh"><i class="fas fa-id-card"></i> Anexar CNH (Carteira Nacional de Habilitação) ou documento do proprietario:</label>
                    <div class="underline"></div>
                </div>
                <div class="input-field">
                    <input type="file" id="cnh_condutor" name="cnh_condutor" accept=".pdf">
                    <label for="cnh_condutor"><i class="far fa-file"></i> Anexar CNH (Carteira Nacional de Habilitação) ou documento do CONDUTOR:</label>
                    <div class="underline"></div>
                </div>
                <div class="input-field">
                    <input type="file" id="notif_DEMUTRAN" name="notif_DEMUTRAN" accept=".pdf">
                    <label for="notif_DEMUTRAN"><i class="far fa-file"></i> Anexar NOTIFICAÇÃO DEMUTRAN:</label>
                    <div class="underline"></div>
                </div>
                <div class="input-field">
                    <input type="file" id="crlv" name="crlv" accept=".pdf">
                    <label for="crlv"><i class="fas fa-car"></i> Anexar CRLV (Certificado de Registro e Licenciamento do Veículo):</label>
                    <div class="underline"></div>
                </div>
                <div class="input-field">
                    <input type="file" id="comprovante_residencia" name="comprovante_residencia" accept=".pdf">
                    <label for="comprovante_residencia"><i class="far fa-address-card"></i> Anexar COMPROVANTE DE RESIDÊNCIA (Caso não for proprietario):</label>
                    <div class="underline"></div>
                </div>
                <div class="input-field">
                    <input type="file" id="doc_complementares" name="doc_complementares" multiple accept=".pdf">
                    <label for="doc_complementares"><i class="far fa-file"></i> Adicione Documentos Complementares:</label>
                    <div class="underline"></div>
                </div>
                <div class="input-field">
                    <textarea id="descricao" name="descricao" rows="4" ></textarea>
                    <label for="descricao"><i class="fas fa-comment-alt"></i> Descreva sua Solicitação:</label>
                    <div class="underline"></div>
                </div>
                <button type="submit">Enviar</button>
            </div>
            <div class="input-field" id="notif_DEMUTRAN_field" style="display: none;">
                <input type="file" id="notif_DEMUTRAN" name="notif_DEMUTRAN" accept=".pdf">
                <label for="notif_DEMUTRAN"><i class="far fa-file"></i> Anexar NOTIFICAÇÃO DEMUTRAN (preenchida e assina):</label>
                <div class="underline"></div>
                <button style="margin-top: 5px;" onclick="submitForm()" type="submit">Enviar</button>
            </div>
        </form>
    </div>
    <script>
        document.getElementById('tipo_solicitacao').addEventListener('change', function() {
            var formNormal = document.getElementById('form_normal');
            var notifDEMUTRANField = document.getElementById('notif_DEMUTRAN_field');

            if (this.value === 'apresentacao_condutor') {
                formNormal.style.display = 'none';
                notifDEMUTRANField.style.display = 'block';
            } else {
                formNormal.style.display = 'block';
                notifDEMUTRANField.style.display = 'none';
            }
        });

        document.addEventListener("DOMContentLoaded", () => {
            const form = document.getElementById("DefesaForm");
            form.addEventListener("submit", function(event) {
                event.preventDefault();
                submitForm();
            });
        });

        function submitForm() {
            const form = document.getElementById("DefesaForm");
            const formData = new FormData(form);
            console.log(formData.entries());
            
            for (let [key, value] of formData.entries()) {
            if (value instanceof File && value.name !== "" && value.type !== "application/pdf") {
                alert("Todos os arquivos devem estar no formato PDF.");
                return;
            }
        }

            fetch("processa_formulario.php", {
                method: "POST",
                body: formData
            })
            .then(response => response.text())
            .then(data => {
                const feedback = document.getElementById("feedback");
                feedback.innerHTML = data;
                feedback.classList.add("success");
                feedback.classList.remove("error");
                feedback.style.display = "block";
                
                setTimeout(() => {
                    feedback.style.display = "none";
                }, 30000);
            })
            .catch(error => {
                const feedback = document.getElementById("feedback");
                feedback.innerHTML = "Ocorreu um erro ao enviar o formulário.";
                feedback.classList.add("error");
                feedback.classList.remove("success");
                feedback.style.display = "block";
                
                setTimeout(() => {
                    feedback.style.display = "none";
                }, 30000);
            });
        }

    </script>
</body>
</html>